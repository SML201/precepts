---
title: "Precept 12"
author: "wei"
date: "April 28, 2016"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(message=FALSE, cache=TRUE, warning=FALSE)
```


```{r setup}
library(dplyr)
library(ggplot2)
library(knitr)

#source("https://github.com/SML201/precepts/blob/master/week12/setup.R")

load(url("https://github.com/SML201/precepts/raw/master/week12/mnist_sample.RData"))

pca <- function(x, space=c("rows", "columns"), 
                center=TRUE, scale=FALSE) {
  space <- match.arg(space)
  if(space=="columns") {x <- t(x)}
  x <- t(scale(t(x), center=center, scale=scale))
  s <- svd(x)
  loading <- s$u
  colnames(loading) <- paste0("Loading", 1:ncol(loading))
  rownames(loading) <- rownames(x)
  pc <- diag(s$d) %*% t(s$v)
  rownames(pc) <- paste0("PC", 1:nrow(pc))
  colnames(pc) <- colnames(x)
  pve <- s$d^2 / sum(s$d^2)
  if(space=="columns") {pc <- t(pc); loading <- t(loading)}
  return(list(pc=pc, loading=loading, pve=pve))
}

plot_image <- function(image_vector, label=NULL){
  DF <- data.frame(x=rep(1:28, 28), y=-sort(rep(1:28, 28))+28, val=image_vector)
  p <- ggplot(DF, aes(x=x, y=y, fill=image_vector)) + 
	 geom_tile(width=1, height=1) +
	 scale_fill_gradient(low="white", high="black") +
	 coord_fixed(ratio=1) + 
	 theme_void() +
	 geom_segment(aes(x=0, xend=28, y=0, yend=0)) +
	 geom_segment(aes(x=0, xend=28, y=28, yend=28)) +
	 geom_segment(aes(x=0, xend=0, y=0, yend=28)) +
	 geom_segment(aes(x=28, xend=28, y=0, yend=28)) +
	 theme(legend.position="none")
  if(!is.null(label)) {
    p <- p + labs(title=as.character(label))
  }
  p
}


```

Visualize data:
```{r}
IND <- sample(1:nrow(data), 1)
plot_image(data[IND,], label[IND])
```

k-means. Look at cluster assignments. Centers are barely meaningful since we're in this 784-dimensional space.

```{r}
#about 20 sec
km <- kmeans(x=data, centers=10, iter.max = 20)
names(km)
km$cluster %>% head
table(label[which(km$cluster==7)])
```

Hierarchical clustering

```{r}
```

`ggplot2` dendrogram tricks

```{r}
```


PCA:

1. Scree plot
2. Examine principal components

```{r}
pca_out <- pca(data)
```


